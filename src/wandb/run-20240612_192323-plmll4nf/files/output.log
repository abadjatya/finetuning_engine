

  0%|                                                                                                                                                                   | 1/5694 [00:25<41:01:29, 25.94s/it]
{'loss': 2.7808, 'grad_norm': 0.7504469156265259, 'learning_rate': 9.999999238964673e-05, 'epoch': 0.0}

  0%|                                                                                                                                                                   | 2/5694 [00:41<30:58:38, 19.59s/it]

  0%|                                                                                                                                                                   | 3/5694 [00:55<27:06:03, 17.14s/it]

  0%|                                                                                                                                                                   | 4/5694 [01:10<25:47:43, 16.32s/it]

  0%|▏                                                                                                                                                                  | 5/5694 [01:24<24:31:41, 15.52s/it]

  0%|▏                                                                                                                                                                  | 6/5694 [01:38<23:40:50, 14.99s/it]

  0%|▏                                                                                                                                                                  | 7/5694 [01:53<23:43:13, 15.02s/it]Traceback (most recent call last):
  File "/root/finetuning_engine/src/train.py", line 89, in <module>
    main(model_args, data_args, training_args)
  File "/root/finetuning_engine/src/train.py", line 66, in main
    trainer.train(resume_from_checkpoint=checkpoint)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 361, in train
    output = super().train(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 1859, in train
    return inner_training_loop(
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 2203, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 3138, in training_step
    loss = self.compute_loss(model, inputs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 3161, in compute_loss
    outputs = model(**inputs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 1855, in forward
    loss = self.module(*inputs, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/peft_model.py", line 1129, in forward
    return self.base_model(
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/tuners/tuners_utils.py", line 161, in forward
    return self.model.forward(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 1137, in forward
    outputs = self.model(
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 929, in forward
    layer_outputs = self._gradient_checkpointing_func(
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_compile.py", line 24, in inner
    return torch._dynamo.disable(fn, recursive)(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
    return fn(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 36, in inner
    return fn(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/checkpoint.py", line 487, in checkpoint
    return CheckpointFunction.apply(function, preserve, *args)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/autograd/function.py", line 598, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/checkpoint.py", line 262, in forward
    outputs = run_function(*args)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 676, in forward
    hidden_states_mlp = self.mlp(hidden_states)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 178, in forward
    down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/tuners/lora/layer.py", line 509, in forward
    result = result + lora_B(lora_A(dropout(x))) * scaling
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1571, in _call_impl
    args_result = hook(self, args)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 278, in _pre_forward_module_hook
    self.pre_sub_module_forward_function(module)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 452, in pre_sub_module_forward_function
    param_coordinator.fetch_sub_module(sub_module, forward=True)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
    return fn(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 385, in fetch_sub_module
    self.__all_gather_params(params_to_prefetch, forward)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 434, in __all_gather_params
    self.__all_gather_params_(nonquantized_params, forward, quantize=self.zero_quantized_weights)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 463, in __all_gather_params_
    handle = param_group[0].all_gather_coalesced(param_group, quantize=quantize)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1259, in all_gather_coalesced
    handles.append(_all_gather_dtype(dtype, params, world_size, rank_in_group, ds_process_group))
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1145, in _all_gather_dtype
    instrument_w_nvtx(torch.cat)([p.ds_tensor.to(get_accelerator().current_device_name()) for p in params],
  File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1145, in <listcomp>
    instrument_w_nvtx(torch.cat)([p.ds_tensor.to(get_accelerator().current_device_name()) for p in params],
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/root/finetuning_engine/src/train.py", line 89, in <module>
[rank0]:     main(model_args, data_args, training_args)
[rank0]:   File "/root/finetuning_engine/src/train.py", line 66, in main
[rank0]:     trainer.train(resume_from_checkpoint=checkpoint)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 361, in train
[rank0]:     output = super().train(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 1859, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 2203, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 3138, in training_step
[rank0]:     loss = self.compute_loss(model, inputs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/trainer.py", line 3161, in compute_loss
[rank0]:     outputs = model(**inputs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 1855, in forward
[rank0]:     loss = self.module(*inputs, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/peft_model.py", line 1129, in forward
[rank0]:     return self.base_model(
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/tuners/tuners_utils.py", line 161, in forward
[rank0]:     return self.model.forward(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 1137, in forward
[rank0]:     outputs = self.model(
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 929, in forward
[rank0]:     layer_outputs = self._gradient_checkpointing_func(
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_compile.py", line 24, in inner
[rank0]:     return torch._dynamo.disable(fn, recursive)(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 36, in inner
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/checkpoint.py", line 487, in checkpoint
[rank0]:     return CheckpointFunction.apply(function, preserve, *args)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/autograd/function.py", line 598, in apply
[rank0]:     return super().apply(*args, **kwargs)  # type: ignore[misc]
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/checkpoint.py", line 262, in forward
[rank0]:     outputs = run_function(*args)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 676, in forward
[rank0]:     hidden_states_mlp = self.mlp(hidden_states)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/transformers/models/cohere/modeling_cohere.py", line 178, in forward
[rank0]:     down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/peft/tuners/lora/layer.py", line 509, in forward
[rank0]:     result = result + lora_B(lora_A(dropout(x))) * scaling
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1571, in _call_impl
[rank0]:     args_result = hook(self, args)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 278, in _pre_forward_module_hook
[rank0]:     self.pre_sub_module_forward_function(module)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 452, in pre_sub_module_forward_function
[rank0]:     param_coordinator.fetch_sub_module(sub_module, forward=True)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 385, in fetch_sub_module
[rank0]:     self.__all_gather_params(params_to_prefetch, forward)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 434, in __all_gather_params
[rank0]:     self.__all_gather_params_(nonquantized_params, forward, quantize=self.zero_quantized_weights)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 463, in __all_gather_params_
[rank0]:     handle = param_group[0].all_gather_coalesced(param_group, quantize=quantize)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1259, in all_gather_coalesced
[rank0]:     handles.append(_all_gather_dtype(dtype, params, world_size, rank_in_group, ds_process_group))
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1145, in _all_gather_dtype
[rank0]:     instrument_w_nvtx(torch.cat)([p.ds_tensor.to(get_accelerator().current_device_name()) for p in params],
[rank0]:   File "/root/finetuning_engine/finetuning_env/lib/python3.10/site-packages/deepspeed/runtime/zero/partition_parameters.py", line 1145, in <listcomp>
[rank0]:     instrument_w_nvtx(torch.cat)([p.ds_tensor.to(get_accelerator().current_device_name()) for p in params],
[rank0]: KeyboardInterrupt